<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ChatGPT ì§ˆë¬¸í•˜ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSRF í† í° ì •ë³´ -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4">ChatGPTì—ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš” ğŸ§ </h2>

    <div class="mb-3">
        <label for="question" class="form-label">ì§ˆë¬¸</label>
        <input type="text" class="form-control" id="question" placeholder="ì˜ˆ: ì˜¤ëŠ˜ ë‚ ì”¨ ì–´ë•Œ?" required>
    </div>
    <button id="askBtn" class="btn btn-primary">ì§ˆë¬¸í•˜ê¸°</button>

    <hr>

    <div id="result" style="display:none;">
        <h5 class="mt-4">ğŸ™‹ ì§ˆë¬¸:</h5>
        <p id="qText"></p>

        <h5 class="mt-3">ğŸ¤– ë‹µë³€:</h5>
        <div class="border p-3 bg-white rounded">
            <p id="aText"></p>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        const token = $("meta[name='_csrf']").attr("content");
        const header = $("meta[name='_csrf_header']").attr("content");

        $("#askBtn").click(function () {
            const question = $("#question").val().trim();
            if (!question) {
                alert("ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            $.ajax({
                type: "POST",
                url: "/api/chat/ask",
                data: { question: question },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success: function (response) {
                    $("#qText").text(question);
                    $("#aText").text(response);
                    $("#result").show();
                },
                error: function () {
                    alert("ChatGPT í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });
        });
    });
</script>

</body>
</html>
